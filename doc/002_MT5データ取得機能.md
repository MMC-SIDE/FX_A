# チケット002: MT5データ取得機能

## 概要
MT5からリアルタイム価格データと履歴データを取得する機能を実装する。

## 目的
- MT5から各種データを安定して取得
- データベースへの効率的な保存
- リアルタイムデータ配信機能

## 要件
- OHLCV価格データの取得
- 複数通貨ペアの同時監視
- 複数時間軸のデータ取得
- リアルタイム価格配信

## 受け入れ基準
- [ ] MT5接続クライアントクラスの実装
- [ ] 価格データ取得APIの実装
- [ ] データベース保存機能
- [ ] WebSocket経由のリアルタイム配信
- [ ] エラー処理と自動再接続機能

## 技術仕様

### MT5クライアント
```python
# backend/core/mt5_client.py
class MT5Client:
    def __init__(self, config_path: str):
        self.config = self.load_config(config_path)
    
    def connect(self) -> bool:
        """MT5への接続"""
        
    def get_rates(self, symbol: str, timeframe: int, count: int):
        """価格データ取得"""
        
    def get_tick(self, symbol: str):
        """最新ティック取得"""
        
    def disconnect(self):
        """接続終了"""
```

### データベーススキーマ
```sql
CREATE TABLE price_data (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL,
    timeframe VARCHAR(5) NOT NULL,
    time TIMESTAMPTZ NOT NULL,
    open DECIMAL(10,5) NOT NULL,
    high DECIMAL(10,5) NOT NULL,
    low DECIMAL(10,5) NOT NULL,
    close DECIMAL(10,5) NOT NULL,
    tick_volume BIGINT,
    spread INT,
    real_volume BIGINT,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(symbol, timeframe, time)
);

-- TimescaleDBハイパーテーブル化
SELECT create_hypertable('price_data', 'time');
```

### API エンドポイント
```python
# GET /api/v1/market/symbols
# GET /api/v1/market/prices/{symbol}
# GET /api/v1/market/rates/{symbol}/{timeframe}
# WebSocket /ws/market
```

## 対象通貨ペア
- USD/JPY, EUR/JPY, GBP/JPY
- AUD/JPY, NZD/JPY, CAD/JPY, CHF/JPY

## 対象時間軸
- M1, M5, M15, M30, H1, H4, D1

## パフォーマンス要件
- データ取得レスポンス: 1秒以内
- WebSocket配信遅延: 100ms以内
- データベース書き込み: バッチ処理で効率化

## エラーハンドリング
- 接続断時の自動再接続（最大3回）
- データ取得失敗時のリトライ機能
- ログ出力とアラート通知

## 見積もり
**3日**

## 依存関係
- チケット001: 環境構築

## 完了条件
- [ ] 全通貨ペアのデータが正常に取得できる
- [ ] データベースに正しく保存される
- [ ] WebSocketでリアルタイム配信される
- [ ] エラー時の自動復旧が動作する